<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOWERN Climate Factors Visual Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #1e3a8a; /* Dark Blue */
            --secondary-color: #6c757d;
            --success-color: #10b981; /* Emerald Green */
            --error-color: #ef4444; /* Red */
            --bg-color: #f3f4f6; /* Light Gray */
            --card-bg: #ffffff;
            --font-family: 'Inter', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
            margin: auto;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
        }

        .match-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .factor-list, .description-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .factor-item, .description-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, opacity 0.3s;
            font-size: 1.05em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .factor-item {
            background-color: #e0f7fa; /* Light Blue */
            border-left: 6px solid var(--primary-color);
            font-weight: 600;
        }
        
        .factor-item .emoji {
            margin-right: 8px;
            font-size: 1.3em;
        }

        .description-item {
            background-color: #fff3e0; /* Light Orange */
            border-right: 6px solid var(--primary-color);
        }

        .description-item .cue {
            margin-right: 8px;
            font-size: 1.3em;
            font-weight: bold;
        }


        .factor-item:hover:not(.correct), .description-item:hover:not(.correct) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .selected {
            border: 2px solid var(--success-color) !important;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.7) !important;
            background-color: #d1fae5 !important;
        }
        
        .correct {
            background-color: #d1fae5;
            border-color: var(--success-color);
            color: #065f46;
            opacity: 0.5;
            pointer-events: none;
        }

        .incorrect {
            background-color: #fee2e2;
            border-color: var(--error-color);
            color: var(--error-color);
        }

        /* --- Global Button Styling --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.1s;
            font-weight: 500;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #102e6c;
            transform: translateY(-1px);
        }

        .reset-btn {
            display: block;
            width: 150px;
            margin: 20px auto 0;
        }

        /* --- Pop-up Challenge Styling --- */
        .challenge-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .challenge-box {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            animation: bounceIn 0.5s ease-out;
            max-width: 450px;
            width: 90%;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }

        .challenge-box h2 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1.5rem;
        }

        .challenge-options button {
            background-color: #f0f0f0;
            border: 2px solid #9ca3af;
            color: #333;
            padding: 10px 15px;
            margin: 8px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s, transform 0.1s;
            width: 100%; 
            max-width: 200px;
        }
        
        @media (min-width: 640px) {
            .challenge-options button {
                width: auto;
            }
        }

        .challenge-options button:hover:not(:disabled) {
            background-color: #e9ecef;
            transform: translateY(-1px);
        }

        .challenge-options button.correct-answer {
            background-color: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        
        .challenge-options button.wrong-answer {
            background-color: var(--error-color);
            color: white;
            border-color: var(--error-color);
        }

        /* --- Review Panel Styling --- */
        #review-panel {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            background-color: #fff;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 0 20px;
        }

        #review-panel.open {
            max-height: 800px; /* Large enough to show all content */
            padding: 20px;
        }

        .review-panel table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .review-panel th, .review-panel td {
            padding: 10px;
            border: 1px solid #e5e7eb;
            text-align: left;
        }

        .review-panel th {
            background-color: #f3f4f6;
            font-weight: 600;
        }
        
        .review-panel h2 {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 15px;
            margin-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-extrabold tracking-tight">üåé LOWERN Climate Factors: Full Visual Challenge</h1>
        <p class="text-center text-gray-600 mb-6">Match the **Factor** to its **Description**. Correct matches trigger a **Quick Quiz** pop-up to reinforce a key concept!</p>
        
        <div class="flex justify-center mb-4">
            <button id="toggle-review-btn" class="btn btn-primary" onclick="toggleReviewPanel()">
                <span id="btn-text">Open Review Sheet üìñ</span>
            </button>
        </div>

        <!-- Review Panel (Cheat Sheet) -->
        <div id="review-panel" class="review-panel">
            <h2 class="text-xl">LOWERN Climate Factors: Quick Review Sheet</h2>
            <p class="text-sm text-gray-500 mb-4">Use this chart if you get stuck!</p>

            <h2 class="text-lg">L: Latitude (Distance from the Equator)</h2>
            <table>
                <thead><tr><th>Concept</th><th>Effect</th><th>Key Terminology</th></tr></thead>
                <tbody>
                    <tr><td>**Direct Light** (Near Equator)</td><td>The sun's energy is **concentrated** over a small area.</td><td>Concentrated, Hotter, Tropical/Low Latitude</td></tr>
                    <tr><td>**Indirect Light** (Near Poles)</td><td>The sun's energy is **spread out** over a large area.</td><td>Spread Out, Colder, Polar/High Latitude</td></tr>
                </tbody>
            </table>

            <h2 class="text-lg">O: Ocean Currents (Warm and Cold 'Rivers' in the Ocean)</h2>
            <table>
                <thead><tr><th>Concept</th><th>Effect</th><th>Key Terminology</th></tr></thead>
                <tbody>
                    <tr><td>**Warm Currents** (e.g., Gulf Stream)</td><td>Transport heat to the coasts, making winter temperatures **milder**.</td><td>Moderation, Warming Influence</td></tr>
                    <tr><td>**Cold Currents** (e.g., Labrador Current)</td><td>Transport cold water, often leading to cooler, foggier conditions.</td><td>Cooling Influence, Less Evaporation</td></tr>
                </tbody>
            </table>

            <h2 class="text-lg">W: Winds & Air Masses (Large Bodies of Air)</h2>
            <table>
                <thead><tr><th>Concept</th><th>Effect</th><th>Key Terminology</th></tr></thead>
                <tbody>
                    <tr><td>**Air Mass Origin**</td><td>Takes on the properties of where it forms.</td><td>**Maritime** (Moist), **Continental** (Dry)</td></tr>
                    <tr><td>**Air Mass Temperature**</td><td>Takes on the temperature of where it forms.</td><td>**Tropical** (Warm), **Polar/Arctic** (Cold)</td></tr>
                </tbody>
            </table>
            
            <h2 class="text-lg">E: Elevation (Altitude above Sea Level)</h2>
            <table>
                <thead><tr><th>Concept</th><th>Effect</th><th>Key Terminology</th></tr></thead>
                <tbody>
                    <tr><td>**Rising Air**</td><td>As air rises, it expands due to lower air pressure, causing it to **cool**.</td><td>Cooler Temperatures, Decrease in Pressure</td></tr>
                    <tr><td>**Temperature Rule**</td><td>Temperature drops approximately 0.6¬∞C - 1.0¬∞C per 100 meters.</td><td>Altitude, Mountain Climate</td></tr>
                </tbody>
            </table>

            <h2 class="text-lg">R: Relief (Mountains and Land Shape)</h2>
            <table>
                <thead><tr><th>Concept</th><th>Effect</th><th>Key Terminology</th></tr></thead>
                <tbody>
                    <tr><td>**Windward Side**</td><td>Air rises, cools, moisture condenses, resulting in **heavy precipitation**.</td><td>High Rainfall, Condensation</td></tr>
                    <tr><td>**Leeward Side**</td><td>Air descends, warms, resulting in dry conditions.</td><td>**Rain Shadow**, Dry, Deserts</td></tr>
                </tbody>
            </table>

            <h2 class="text-lg">N: Near Water (Proximity to Oceans/Lakes)</h2>
            <table>
                <thead><tr><th>Concept</th><th>Effect</th><th>Key Terminology</th></tr></thead>
                <tbody>
                    <tr><td>**Water's Heat Capacity**</td><td>Water takes a long time to warm up and cool down.</td><td>**Continental Climate** (Extreme temperatures inland)</td></tr>
                    <tr><td>**Moderating Effect**</td><td>Coastlines have **cooler summers** and **warmer winters** than inland areas.</td><td>Maritime Climate, Moderation</td></tr>
                </tbody>
            </table>
        </div>

        <!-- The actual game area -->
        <div class="match-area mt-6">
            <ul class="factor-list" id="factor-list"></ul>
            <ul class="description-list" id="description-list"></ul>
        </div>
        
        <div id="feedback" class="mt-6 p-4 rounded-lg border text-center" style="display: none;"></div>

        <button class="reset-btn btn btn-primary" onclick="initGame()">Reset Game</button>
    </div>

    <!-- Pop-up Challenge HTML -->
    <div id="challenge-overlay" class="challenge-overlay" style="display: none;">
        <div id="challenge-box" class="challenge-box">
            <h2 id="challenge-title" class="font-bold">Quick Quiz! ‚ö°</h2>
            <p id="challenge-question" class="text-gray-700 mb-4"></p>
            <div id="challenge-options" class="challenge-options flex flex-wrap justify-center">
                <!-- Buttons injected here -->
            </div>
            <p id="challenge-result" class="mt-4 font-bold"></p>
        </div>
    </div>

    <script>
        // Data for the game, including descriptive cues
        const matches = [
            {
                factor: "Latitude (L) ‚òÄÔ∏è",
                id: "L",
                cue: "üéØ", // Direct/Concentrated light
                description: "Determines how concentrated or spread out the sun's energy is. Near the equator (0¬∞), light is direct and concentrated (hot). Near the poles, it is indirect and spread out (cold).",
                emoji: "‚òÄÔ∏è",
                quiz: {
                    question: "At the **equator (0¬∞)**, the sunlight is...?",
                    correct: "Directly Overhead / Concentrated",
                    wrong1: "Low Angle / Spread Out",
                    wrong2: "Blocked by Atmosphere"
                }
            },
            {
                factor: "Ocean Currents (O) üåä",
                id: "O",
                cue: "üå°Ô∏è", // Temperature transfer/Warmth
                description: "Like a 'river within the ocean.' Warm currents (e.g., Gulf Stream) carry heat, warming the air above it, which then affects the climate of nearby land.",
                emoji: "üåä",
                quiz: {
                    question: "The **North Atlantic Current** and **Gulf Stream** are examples of what kind of current?",
                    correct: "Warm Currents (Red Arrows)",
                    wrong1: "Cold Currents (Blue Arrows)",
                    wrong2: "Arctic Currents"
                }
            },
            {
                factor: "Winds & Air Masses (W) üí®",
                id: "W",
                cue: "üå¨Ô∏è", // Moving air
                description: "Large volumes of air that take on temperature and moisture where they form. They distribute weather: **Continental Arctic (cA)** air is very cold and dry.",
                emoji: "üí®",
                quiz: {
                    question: "An air mass that forms over the **ocean** is called 'Maritime' and is generally...",
                    correct: "Moist (High Humidity)",
                    wrong1: "Dry (Low Humidity)",
                    wrong2: "Always Tropical"
                }
            },
            {
                factor: "Elevation (E) üå°Ô∏è",
                id: "E",
                cue: "üìâ", // Drop in temperature
                description: "The height of land above sea level (altitude). As air rises, it expands due to low pressure, causing it to cool, making high places colder than low places.",
                emoji: "üå°Ô∏è",
                quiz: {
                    question: "What is the typical change in temperature as you go **higher** in elevation?",
                    correct: "Temperature drops (gets colder)",
                    wrong1: "Temperature rises (gets warmer)",
                    wrong2: "Humidity always increases"
                }
            },
            {
                factor: "Relief (R) ‚õ∞Ô∏è",
                id: "R",
                cue: "üåßÔ∏è", // Rain/Moisture
                description: "Causes a 'rain shadow' effect. Moist air rises over a mountain, cools, and drops precipitation (rain) on the **windward** side, leaving only dry air for the **leeward** side.",
                emoji: "‚õ∞Ô∏è",
                quiz: {
                    question: "The dry area created on the downwind side of a mountain is called the...?",
                    correct: "Rain Shadow",
                    wrong1: "Condensation Zone",
                    wrong2: "Arctic Front"
                }
            },
            {
                factor: "Near Water (N) üßä",
                id: "N",
                cue: "‚ÜîÔ∏è", // Moderation/Balance/Switch
                description: "Water heats up and cools down slower than land. This **moderates** the climate, making coastal areas cooler in summer and warmer in winter than inland areas.",
                emoji: "üßä",
                quiz: {
                    question: "A location far inland (e.g., central Saskatchewan) that experiences extreme temperature swings is said to have a...",
                    correct: "Continental Climate",
                    wrong1: "Maritime Climate",
                    wrong2: "Tropical Climate"
                }
            }
        ];

        let selectedFactor = null;
        let selectedDescription = null;
        let matchedIds = [];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function initGame() {
            selectedFactor = null;
            selectedDescription = null;
            matchedIds = [];
            
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'none';
            feedbackEl.className = 'mt-6 p-4 rounded-lg border text-center';
            feedbackEl.innerHTML = '';
            
            closeChallenge();

            const factorList = document.getElementById('factor-list');
            const descriptionList = document.getElementById('description-list');
            factorList.innerHTML = '';
            descriptionList.innerHTML = '';

            const factorData = matches.map(m => ({ id: m.id, text: m.factor }));
            
            // Map descriptions to create an array with all the necessary data
            const descriptionData = matches.map(m => ({ id: m.id, text: m.description, cue: m.cue }));

            shuffleArray(factorData);
            shuffleArray(descriptionData);

            factorData.forEach(data => {
                const match = matches.find(m => m.id === data.id);
                const li = document.createElement('li');
                li.className = 'factor-item';
                li.innerHTML = `<span class="emoji">${match.emoji}</span> ${data.text}`;
                li.dataset.id = data.id;
                li.onclick = () => selectFactor(li);
                factorList.appendChild(li);
            });

            descriptionData.forEach(data => {
                const li = document.createElement('li');
                li.className = 'description-item';
                // Use the cue from the mapped data (which is correct)
                li.innerHTML = `<span class="cue">${data.cue}</span> ${data.text}`;
                li.dataset.id = data.id;
                li.onclick = () => selectDescription(li);
                descriptionList.appendChild(li);
            });
        }

        function clearSelections() {
            document.querySelectorAll('.factor-item:not(.correct), .description-item:not(.correct)').forEach(el => {
                el.classList.remove('selected');
            });
            selectedFactor = null;
            selectedDescription = null;
        }

        function selectFactor(element) {
            if (matchedIds.includes(element.dataset.id)) return;
            document.querySelectorAll('.factor-item:not(.correct)').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedFactor = element;
            checkMatch();
        }

        function selectDescription(element) {
            if (matchedIds.includes(element.dataset.id)) return;
            document.querySelectorAll('.description-item:not(.correct)').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedDescription = element;
            checkMatch();
        }

        function checkMatch() {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'none';
            feedbackEl.className = 'mt-6 p-4 rounded-lg border text-center';

            if (selectedFactor && selectedDescription) {
                const factorId = selectedFactor.dataset.id;
                const descId = selectedDescription.dataset.id;
                const matchInfo = matches.find(m => m.id === factorId);

                if (factorId === descId) {
                    // Correct Match
                    matchedIds.push(factorId);
                    
                    selectedFactor.classList.add('correct');
                    selectedDescription.classList.add('correct');
                    selectedFactor.onclick = null;
                    selectedDescription.onclick = null;
                    
                    feedbackEl.classList.add('correct', 'border-green-500', 'bg-green-100', 'text-green-800');
                    feedbackEl.innerHTML = `<span class="font-bold block mb-1">‚úÖ Correct Match! (${matchInfo.factor})</span>
                                            **CONCEPT RULE**: ${matchInfo.description}`;
                    
                    showChallenge(matchInfo); // TRIGGER NEW CHALLENGE
                    
                } else {
                    // Incorrect Match
                    feedbackEl.classList.add('incorrect', 'border-red-500', 'bg-red-100', 'text-red-800');
                    feedbackEl.innerHTML = `<span class="font-bold block mb-1">‚ùå Incorrect Match!</span>
                                            Try again. Remember: **${selectedFactor.textContent}** refers to the specific physical mechanism that influences climate.`;
                }

                feedbackEl.style.display = 'block';
                clearSelections();
                
                // Check for game completion
                if (matchedIds.length === matches.length) {
                    feedbackEl.classList.remove('incorrect', 'border-red-500', 'bg-red-100', 'text-red-800');
                    feedbackEl.classList.add('correct', 'border-green-500', 'bg-green-100', 'text-green-800');
                    feedbackEl.innerHTML = `<span class="font-bold block mb-1 text-2xl">üéâ ALL FACTORS MASTERED!</span>
                                            You've successfully matched all six LOWERN factors and crushed the quick quizzes. You're ready for the test!`;
                }
            }
        }

        // --- Challenge Functions (Same) ---

        function showChallenge(match) {
            const challengeOverlay = document.getElementById('challenge-overlay');
            const questionEl = document.getElementById('challenge-question');
            const optionsEl = document.getElementById('challenge-options');
            const resultEl = document.getElementById('challenge-result');

            questionEl.textContent = match.quiz.question;
            resultEl.textContent = '';
            optionsEl.innerHTML = '';
            
            const options = [
                { text: match.quiz.correct, isCorrect: true },
                { text: match.quiz.wrong1, isCorrect: false },
                { text: match.quiz.wrong2, isCorrect: false }
            ];
            shuffleArray(options);

            options.forEach(opt => {
                const button = document.createElement('button');
                button.textContent = opt.text;
                button.onclick = () => checkChallengeAnswer(button, opt.isCorrect, optionsEl, resultEl, match.quiz.correct);
                optionsEl.appendChild(button);
            });

            challengeOverlay.style.display = 'flex';
        }

        function checkChallengeAnswer(clickedButton, isCorrect, optionsEl, resultEl, correctText) {
            // Disable all buttons after selection
            Array.from(optionsEl.children).forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                clickedButton.classList.add('correct-answer');
                resultEl.classList.remove('text-red-600');
                resultEl.classList.add('text-green-600');
                resultEl.textContent = "‚úÖ Great Job! That detail reinforces the concept.";
                // Close after a brief delay
                setTimeout(closeChallenge, 1500);
            } else {
                clickedButton.classList.add('wrong-answer');
                resultEl.classList.remove('text-green-600');
                resultEl.classList.add('text-red-600');
                resultEl.textContent = "‚ùå Not quite. Review the visual data!";
                
                // Highlight the correct answer
                Array.from(optionsEl.children).forEach(btn => {
                    if (btn.textContent === correctText) {
                        btn.classList.add('correct-answer');
                    }
                });
                // Close after a longer delay to read the feedback
                setTimeout(closeChallenge, 3000); 
            }
        }

        function closeChallenge() {
            document.getElementById('challenge-overlay').style.display = 'none';
        }

        // --- New Toggle Functionality ---
        function toggleReviewPanel() {
            const panel = document.getElementById('review-panel');
            const btnText = document.getElementById('btn-text');
            
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                btnText.textContent = 'Open Review Sheet üìñ';
            } else {
                panel.classList.add('open');
                btnText.textContent = 'Close Review Sheet ‚ùå';
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
